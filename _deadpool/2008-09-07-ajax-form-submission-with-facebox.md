<p>So you want a facebox that shows a form which does an asynchronous submission and updates the facebox with the results of the submission showing error or success messages.</p>&#13;
<h2>Setting up the facebox.</h2>&#13;
<p>Grab the files from <a href="http://famspam.com/facebox">famspam</a> and install all the images, css and javascript.</p>&#13;
<p>Create a link that when clicked will display the facebox and set its <code>rel</code> attribute to <code>'facebox'</code>. Create a div that contains what you want to show in the facebox and hide the div. Now set the href of that link you created to the id of the div.</p>&#13;
<pre><code class="ruby">link_to("Request an invitation", '#invitation_request', :rel =&gt; 'facebox')&#13;
&lt;div id='invitation_request' style='display: none;'&gt;&#13;
  &lt;form action='do/something' id='invitation_request_form'&gt;&#13;
    ...&#13;
  &lt;/form&gt;&#13;
&lt;/div&gt;&#13;
</code></pre>&#13;
<p>Add the javascript to tie it all together.</p>&#13;
<pre><code class="ruby">$('a[rel*=facebox]').facebox()&#13;
</code></pre>&#13;
<h2>Asynchronize the form</h2>&#13;
<p>At this point you have a facebox that works when the link is clicked. The form is still going to do a regular form submission. To make it an XHR post, grab the jquery.form plugin.</p>&#13;
<p>To hook it up to the form, you need the id of the form, which thanks to the way facebox works, is not unique within the dom. Facebox clones the div you created and places the clone within another generated div with the id <code>facebox</code>. If you follow the jquery.form instructions and do something like</p>&#13;
<pre><code class="javascript">$('#invitation_request_form').ajaxForm({&#13;
      success: function(html){&#13;
        $('#invitation_request').html(html);&#13;
      }&#13;
});&#13;
</code></pre>&#13;
<p>your form submission will still not be asynchronous. That's because the jQuery selector <code>'#invitation_request_form'</code> is ambiguous within the dom. Make it more specific by using the generated <code>facebox</code> div to ensure the <code>ajaxForm</code> function binds to the correct form.</p>&#13;
<pre><code class="javascript">$('#facebox').livequery(function() {&#13;
  $(this).find('#invitation_request_form').ajaxForm({&#13;
      success: function(html){&#13;
        $('#facebox').find('#invitation_request').html(html);&#13;
      }&#13;
  });&#13;
});&#13;
</code></pre>&#13;
<h2>Attack of the clones</h2>&#13;
<p>Let's say you want to insert the response from the form submission back into the facebox. This way you can redisplay the form with any appropriate error messages or maybe a success message. You'll run into the same clone issue when specifying the div whose html is to be replaced. Be sure to focus the jQuery selector syntax using the <code>facebox</code> div the same way you did for the form.</p>&#13;
<h2>That second form submission</h2>&#13;
<p>Now the form will submit asynchronously and the response will render within the correct div. If you submit the form a second time, however, the request will not be asynchronous. This is because the form is replaced by the first ajax call and the new form does not have the <code>ajaxForm</code> function bound to it. The jQuery livequery plugin solves this final problem by ensuring that even when the form is dynamically inserted into the dom, the ajaxForm function gets bound to it.</p>&#13;
<pre><code class="javascript">  $('#facebox').livequery(function() {&#13;
    $(this).find('#invitation_request_form').livequery(function() {&#13;
      $(this).ajaxForm({&#13;
        success: function(html) {&#13;
          $('#facebox').find('#invitation_request').html(html);&#13;
        }&#13;
      });&#13;
    });&#13;
  });&#13;
</code></pre> 
